@using Microsoft.AspNetCore.Identity
@using SporWebDeneme1.Entities.Models
@model RegisterViewModel
@{
	var failMessage = TempData["FailMessage"] as string;
	var cities = ViewBag.Cities as List<City>;
	var districts = ViewBag.Districts as List<District>;
	var roles = ViewBag.Roles as List<IdentityRole>;
}


<section class="gradient-custom py-5">
	<div class="container py-5 h-100">
		<div class="row justify-content-center align-items-center h-100">
			<div class="col-12 col-lg-9 col-xl-7">
				<div class="card shadow-2-strong card-registration" style="border-radius: 15px;">
					<div class="card-body p-4 p-md-5">
						@if (!string.IsNullOrEmpty(failMessage))
						{
							<div class="alert alert-danger">
								@failMessage
							</div>
						}
						<h3 class="mb-4 pb-2 pb-md-0 mb-md-5">Kullanıcı Kayıt Formu</h3>


						<form method="post" asp-action="Create">

							<div class="row">
								<div class="col-md-12 mb-4">
									<div data-mdb-input-init class="form-outline">
										<input type="text" asp-for="TCNO" class="form-control form-control-lg"
											   type="tel"
											   maxlength="11"
											   pattern="[0-9]*"
											   inputmode="numeric"
											   required
											   onkeypress="return event.charCode >= 48 && event.charCode <= 57" />
										<span asp-validation-for="TCNO" class="text-danger"></span>
									</div>
									<label class="form-label" asp-for="TCNO">TC Kimlik Numarası</label>
								</div>
								<div class="col-md-6 mb-4">
									<div data-mdb-input-init class="form-outline">
										<input type="text" asp-for="Name" class="form-control form-control-lg" required
											   onkeypress="return !(event.charCode >= 48 && event.charCode <= 57)" />
										<label class="form-label" asp-for="Name">İsim</label>
										<span asp-validation-for="Name" class="text-danger"></span>
									</div>

								</div>
								<div class="col-md-6 mb-4">

									<div data-mdb-input-init class="form-outline">
										<input type="text" asp-for="Lastname" class="form-control form-control-lg" required
											   onkeypress="return !(event.charCode >= 48 && event.charCode <= 57)" />
										<label class="form-label" asp-for="Lastname">Soyisim</label>
										<span asp-validation-for="Lastname" class="text-danger"></span>
									</div>

								</div>
							</div>

							<div class="row">
								<div class="col-md-6 mb-4 d-flex align-items-center">

									<div data-mdb-input-init class="form-outline datepicker w-100">
										<input type="date" class="form-control form-control-lg" asp-for="BirthDate" required />
										<label asp-for="BirthDate" class="form-label">Doğum Tarihi</label>
										<span asp-validation-for="BirthDate" class="text-danger"></span>
									</div>

								</div>
								<div class="col-md-6">

									<h6 class="mb-2 pb-1">Cinsiyet: </h6>
									<span asp-validation-for="Gender" class="text-danger"></span>

									<div class="form-check form-check-inline">
										<input class="form-check-input" type="radio" id="woman" asp-for="Gender"
											   value="K" checked />
										<label class="form-check-label" for="woman" asp-for="Gender">Kadın</label>
									</div>

									<div class="form-check form-check-inline">
										<input class="form-check-input" type="radio" id="man" asp-for="Gender"
											   value="E" />
										<label class="form-check-label" for="man" asp-for="Gender">Erkek</label>
									</div>
								</div>
							</div>

							<div class="row">
								<div class="col-md-6 mb-4 pb-2">

									<div data-mdb-input-init class="form-outline">
										<input type="email" class="form-control form-control-lg" asp-for="Email" required placeholder="ornek@xmail.com" />
										<label class="form-label" asp-for="Email">E-Posta</label>
										<span asp-validation-for="Email" class="text-danger"></span>
									</div>

								</div>
								<div class="col-md-6 mb-4 pb-2">
									<div data-mdb-input-init class="form-outline">
										<input asp-for="PhoneNumber"
											   class="form-control form-control-lg"
											   type="tel"
											   maxlength="11"
											   pattern="[0-9]*"
											   inputmode="numeric"
											   onkeypress="return event.charCode >= 48 && event.charCode <= 57"
											   required
											   placeholder="05xxxxxxxxx" />
										<label class="form-label" asp-for="PhoneNumber">Telefon Numarası</label>
										<span asp-validation-for="PhoneNumber" class="text-danger"></span>
									</div>

								</div>
							</div>

							<div class="row">
								<div class="col-6 mb-5">

									<select class="select form-control-lg" asp-for="BloodType" required>
										<option value="A">A</option>
										<option value="B">B</option>
										<option value="AB">AB</option>
										<option value="0">0</option>
									</select>
									<label class="form-label" asp-for="BloodType">Kan Grubu</label>
									<select class="select form-control-lg" asp-for="Rh">
										<option value="-">-</option>
										<option value="+">+</option>
									</select>
									<label class="form-label" asp-for="Rh">Rh</label>

								</div>
								<div class="col-6 mb-5">
									<select class="select form-control-lg" name="roleName" required>
										<option value="" selected disabled>Rol Seçiniz</option>
										@foreach (var role in roles)
										{
											<option value="@role.Name">@role.Name</option>
										}
									</select>
								</div>

								<div class="col-6 mb-5">
									<select id="city" class="select form-control-lg mb-2" asp-for="CityId" required>
										<option value="" selected disabled>İl Seçiniz</option>
										@foreach (var city in cities)
										{
											<option value="@city.CityId">@city.CityName</option>
										}
									</select>
									<label class="form-label" asp-for="CityId">İl</label>
									<br />
									<select id="district" class="select form-control-lg" asp-for="DistrictId" required>
										<option value="">Önce il seçiniz</option>
									</select>
									<label class="form-label" asp-for="DistrictId">İlçe</label>

								</div>
								<div class="col-6 mb-5">
									<textarea class="form-control form-control-lg" asp-for="Address" placeholder="Adres giriniz..." required></textarea>
									<label class="form-label" asp-for="Address">Adres</label>
									<span asp-validation-for="Address" class="text-danger"></span>
								</div>
								<div class="col-6">
									<input type="password" asp-for="Password" class="form-control form-control-lg" required />
									<label asp-for="Password" class="form-label">Şifre</label>
									<span asp-validation-for="Password" class="text-danger"></span>
								</div>
								<div class="col-6">
									<input type="password" asp-for="ConfirmPassword" class="form-control form-control-lg" required />
									<label asp-for="ConfirmPassword" class="form-label">Tekrar Şifre</label>
									<span asp-validation-for="ConfirmPassword" class="text-danger"></span>
								</div>
							</div>

							<div class="mt-4 pt-2">
								<button class="btn btn-primary btn-lg" type="submit">Kayıt Ol</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>

@section Scripts {
	@await Html.PartialAsync("_ValidationScriptsPartial")
	<script>
		$(document).ready(function () {
			$('#city').on('change', function () {
				var cityId = $(this).val();
				if (cityId) {
					$.ajax({
						url: '/Account/GetDistrictsByCityId',
						type: 'GET',
						data: { cityId: cityId },
						success: function (data) {
							var districtSelect = $('#district');
							districtSelect.empty();
							$.each(data, function (i, district) {
								districtSelect.append($('<option>', {
									value: district.districtId,
									text: district.districtName
								}));
							});
						},
						error: function () {
							alert('İlçeler yüklenirken bir hata oluştu.');
						}
					});
				} else {
					$('#district').empty().append('<option value="">Önce il seçiniz</option>');
				}
			});
		});
	</script>
}